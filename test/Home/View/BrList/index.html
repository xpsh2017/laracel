<extend name="Public:app" />
<block name="content">

<main>
    <div class="container-fluid">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title pull-left" style="margin-right: 15px;">Parameters Screening
                </h3>
                <a class=" btn btn-xs btn-success pull-left" style="margin-right: 5px;"  href="javascript:;" id="pre_day"> <i class="glyphicon glyphicon-chevron-left"></i> 前一天 </a>
                <a class=" btn btn-xs btn-success pull-left" style="margin-right: 5px;" href="javascript:;" id="next_day"> 后一天 <i class="glyphicon glyphicon-chevron-right"></i> </a>
                <div class="clearfix"></div>
            </div>
            <form action="{:U('BrList/index')}" method="POST"  class="form-horizontal">
                <input type="hidden" name="page" value="" id="page">
                <input type="hidden" name="site" value="{$site}" id="site">
                <input type="hidden"  name='date' value="{$date}" id="date">
                <input type="hidden" name="limit" value="50" id="limit">
                <input type="hidden"  value="{$uuidList}" id="uuidList">
                <input type="hidden"  value="{$type}" id="type">
                <input type="hidden"  name="pre" value="" id="p">
                <input type="hidden"  name="next" value="" id="n">
                <div class="panel-body">
                    <!--<div class="form-inline">
                        <span><b>site：</b></span>
                        <select name="site" class="form-control">
                            <volist name="sites" id="vo" >
                                <option value="{$key}" <eq name="search.site" value="$key">selected="selected"</eq>>{$key}</option>
                            </volist>
                        </select>
                    </div>
                    <br>-->
                    <div class="form-inline">
                        <span><b>Date：</b></span>
                        <div class="input-daterange input-group datepicker">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-time"></i></span>
                            <input type="text" class="input-sm form-control" name="date" value="{$date}" id="datepick"/>
                        </div>&emsp;
                       <!-- <span><b>Pos Range：</b></span>
                        <select name="posRange" class="form-control">
                            <option value="">please choose pos range</option>
                            <option value="0-3" <eq name="search.posRange" value="0-3">selected="selected"</eq>>0-3</option>
                            <option value="3-8" <eq name="search.posRange" value="3-8">selected="selected"</eq>>3-8</option>
                            <option value="8-" <eq name="search.posRange" value="8-">selected="selected"</eq>>>8</option>
                        </select>&emsp;-->
                    </div><br>
                    <div class="form-inline">
                        <span><b>Metrics Sort Order：</b></span>
                        <select name="order" class="form-control">
                            <option value="brChange" <eq name="search.order" value="brChange">selected="selected"</eq>>BR Change</option>
                            <option value="todayBR" <eq name="search.order" value="todayBR">selected="selected"</eq>>Today BR</option>
                        </select>&emsp;
                        <span><b>Sort By：</b></span>
                        <select name="sort" class="form-control">
                            <option value="desc" <eq name="search.sort" value="desc">selected="selected"</eq>>DESC</option>
                            <option value="asc"  <eq name="search.sort" value="asc">selected="selected"</eq>>ASC</option>
                        </select>
                    </div><br>
                </div>
                <div class="panel-footer">
                    <button type="button" class="btn btn-success col-sm-offset-2 " id="btn">确定</button>
                </div>
            </form>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">站点页面BR值列表</h3>
            </div>
            <!--<div class="panel-body">-->
            <table class="table table-striped table-bordered table-hover mytable">
                <thead>
                <tr role="row">
                     <!--<th>全选
                         <input type="checkbox" name="checkAll">
                     </th>-->
                    <th>LandingPage</th>
                    <th>SESSION</th>
                    <th>Position</th>
                    <th>BR</th>
                    <th>BR 警戒值</th>
                    <th>BR Change</th>
                    <th>Code# </th>
                    <th>Code# 新增</th>
                    <th>Code# 下线</th>
                    <th>Promo# </th>
                    <th>Promo# 新增</th>
                    <th>Promo# 下线</th>
                    <!--<th>Avg.Updt Freq 30d</th>-->
                    <th>LandingPage Change Report</th>
                </tr>
                </thead>
                <tbody>
                <volist name="termList" id="vo" >
                    <tr>
                        <!--<td>{$vo.UUID}</td>-->
                        <td><a href="{:U('BrList/get_detail',array(uuid=>$vo['UUID'],type=>$type,date=>$date))}">{$vo.URL}</a></td>
                        <td>{$vo.SESSION}</td>
                        <td>{$vo.todayPos}</td>
                        <td>{$vo.todayBR}</td>
                        <td>{$vo.serpBR}</td>
                        <td>{$vo.brChange}</td>
                        <!--<td>{$vo.promo}</td>
                        <td>{$vo.code}</td>-->

                        <td id="CODE_{$vo.UUID}">0</td>
                        <td id="CODEA_{$vo.UUID}">0</td>
                        <td id="CODEE_{$vo.UUID}">0</td>
                        <td id="PROMO_{$vo.UUID}">0</td>
                        <td id="PROMOA_{$vo.UUID}">0</td>
                        <td id="PROMOE_{$vo.UUID}">0</td>

                        <!--<td id="ID_{$vo.UUID}">0</td>-->
                        <td style="text-align: left;"><a href="http://oi.meikaiinfotech.com/view/showview?filter_name%5B59aa313b44792%5D=598fb72356911&filter%5B59aa313b44792%5D=in&filter_val%5B59aa313b44792%5D={$vo.UUID}&filter_name%5B59aeb5863b395%5D=OBJNAME&filter%5B59aeb5863b395%5D=0&filter_val%5B59aeb5863b395%5D=&filter_name%5B59aa3285f0c75%5D=598fb7235f156&filter%5B59aa3285f0c75%5D=in&filter_val%5B59aa3285f0c75%5D=&filter_name%5B59af8c3ee7d71%5D=598fb72362b08&filter%5B59af8c3ee7d71%5D=0&filter_val%5B59af8c3ee7d71%5D=&quick_select=0&filter_name%5B59af8c3eeaf5d%5D=598fb72362b08&filter%5B59af8c3eeaf5d%5D=0&filter_val%5B59af8c3eeaf5d%5D=&quick_select=0&viewid=59aa30f5bf48f&limit=10
                        ">View Report</a></td>

                    </tr>
                </volist>
                </tbody>
            </table>
            <if condition="$pageList.pages gt 1 ">
                <nav aria-label="Page navigation" class="pull-right">
                    <p class="page_total pull-left">共 {$pageList.total} 条数据</p>
                    <ul class="pagination">
                        <li class="prev">
                            <a href="#" aria-label="Previous" >
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>
                        <for start="$pageList.startPage" end="$pageList.endPage">
                            <li <eq name="pageList.page" value="$i">class='active page'<else/>class='page'</eq> ><a href="#">{$i}</a></li>
                        </for>

                        <li class="next">
                            <a href="#" aria-label="Next" >
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </if>
       <!-- </div>-->

        </div>


    </div>
</main>
</block>
<block name="custome-css">
    <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap-datepicker/1.7.0-RC3/css/bootstrap-datepicker.min.css">
</block>
<block name="custome-js">
    <script src="//cdn.bootcss.com/bootstrap-datepicker/1.7.0-RC3/js/bootstrap-datepicker.min.js"></script>
    <script>
        $(function() {
            $( "#datepick" ).datepicker({
                format: 'yyyy-mm-dd',
                defaultDate : new Date(),
                autoclose: true
            });
            var uuidList = $('#uuidList').val();
            var type = $('#type').val();
            var date =$('#date').val();
            if(uuidList !=''){
                /*$.post("{:U('PosList/get_offset_data')}", { "uuidList": uuidList,"type":type,"date":date},
                        function(data){
                            var ObjArr = data.split(",");
                            //alert(data);
                            for(var i=0;i<ObjArr.length;i++){
                                if(ObjArr[i] !='' && ObjArr[i] !=undefined){
                                    var ClickArr = ObjArr[i].split("_");
                                    $("#ID_"+ClickArr[0]).html(ClickArr[1]);
                                }

                            }
                        }, 'json');*/
                $.post("{:U('BrList/get_code_change')}", { "uuidList": uuidList,"type":type,"date":date},
                        function(data){
                            //alert(data.code);
                            var ObjArr = data.code.split(",");
                            var ObjArr2 = data.codeAdd.split(",");
                            var ObjArr3 = data.codeExpire.split(",");
                            var ObjArr4 = data.promo.split(",");
                            var ObjArr5 = data.promoAdd.split(",");
                            var ObjArr6 = data.promoExpire.split(",");
                            //alert(data);
                            for(var i=0;i<ObjArr.length;i++){
                                if(ObjArr[i] !='' && ObjArr[i] !=undefined){
                                    var ClickArr = ObjArr[i].split("_");
                                    $("#CODE_"+ClickArr[0]).html(ClickArr[1]);
                                }

                            }
                            for(var j=0;j<ObjArr2.length;j++){
                                if(ObjArr2[j] !='' && ObjArr2[j] !=undefined){
                                    var ClickArr2 = ObjArr2[j].split("_");
                                    $("#CODEA_"+ClickArr2[0]).html(ClickArr2[1]);
                                }

                            }
                            for(var i=0;i<ObjArr3.length;i++){
                                if(ObjArr3[i] !='' && ObjArr3[i] !=undefined){
                                    var ClickArr3 = ObjArr3[i].split("_");
                                    $("#CODEE_"+ClickArr3[0]).html(ClickArr3[1]);
                                }

                            }
                            for(var i=0;i<ObjArr4.length;i++){
                                if(ObjArr4[i] !='' && ObjArr4[i] !=undefined){
                                    var ClickArr4 = ObjArr4[i].split("_");
                                    $("#PROMO_"+ClickArr4[0]).html(ClickArr4[1]);
                                }

                            }
                            for(var i=0;i<ObjArr5.length;i++){
                                if(ObjArr5[i] !='' && ObjArr5[i] !=undefined){
                                    var ClickArr5 = ObjArr5[i].split("_");
                                    $("#PROMOA_"+ClickArr5[0]).html(ClickArr5[1]);
                                }

                            }
                            for(var i=0;i<ObjArr6.length;i++){
                                if(ObjArr6[i] !='' && ObjArr6[i] !=undefined){
                                    var ClickArr6 = ObjArr6[i].split("_");
                                    $("#PROMOE_"+ClickArr6[0]).html(ClickArr6[1]);
                                }

                            }

                        }, 'json');
            }
        });
        $('.subSite').click(function(){
            let obj = $(this).children('a')
            let siteName = obj.html()
            let siteUUID = $(this).attr('data-uuid')
            $('.globalSiteName').html(siteName)
            $('.globalSiteName').attr('data-uuid', siteUUID)
            setCookie('SITE_NAME', siteName)
            setCookie('SITE_UUID', siteUUID)
            $('#site').val(siteName);
            $('form').submit();

        })
        /*$('#datepicker').datepicker({
            format: 'yyyy-mm-dd',
            autoclose: false
        }).on('changeDate', function(ev){
            let tmpDate = new Date(ev.date)
            let toYear = tmpDate.getFullYear().toString()
            let toMonth = (tmpDate.getMonth() < 10 ? '0' : '') + (tmpDate.getMonth() +1)
            let toDate = (tmpDate.getDate() < 10 ? '0' : '') + (tmpDate.getDate())
            let date = toYear + '-' + toMonth + '-' + toDate
            $('.globalSiteDate').html(date)
            $('.selectDate').dropdown('toggle')
            setCookie('BR_SITE_DATE', date);
            $('#date').val(date);
            $('form').submit();
        })*/
        $('#btn').click(function(){
            var siteName = $('.globalSiteName').text();
            $('#site').val(siteName);
            $('form').submit();
        })
        $('.page').click(function(){
            var page = $(this).find('a').text();
            $('#page').val(page);
            $('form').submit();
        })
        $('.prev').click(function(){
            var page = $(this).parent().find('.active a').text();
            page = parseInt(page)-1;
            $('#page').val(page);
            $('form').submit();
        })
        $('.next').click(function(){
            var page = $(this).parent().find('.active a').text();
            page = parseInt(page)+1;
            $('#page').val(page);
            $('form').submit();
        })
        $('#pre_day').click(function(){
            $('#p').val(1);
            $('form').submit();
        })
        $('#next_day').click(function(){
            $('#n').val(1);
            $('form').submit();
        })
    </script>
</block>